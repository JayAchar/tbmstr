---
title: "Analysis development"
author: "Jay Achar"
date: "`r Sys.time()`"
output: 
  - html_document
  - officedown::rdocx_document
params:
  tables: "Error" 
  plots: "Error" 
--- 

```{css css, echo=FALSE} 

summary { font-size: 2rem; font-weight: bold; }

h2 {
  font-size: 2rem;
}
```

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(flextable)
library(officedown)
library(officer)

if (knitr::is_html_output()) {
  knitr::knit_hooks$set(
    wrap = function(before, options, envir) {
      if (before) {
        paste0("<details><summary>", options$wrap, "</summary>")
      } else {
        paste0("</details>")
      }
    }
  )
}
```
## Methods

Baseline clinical and demographic characteristics, and treatment and study
outcomes were desdribed for the treatment cohort. Treatment and study outcomes
were also described by baseline HIV status. The crude effects of baseline CD4
count and HIV treatment regimen were described in participants living with HIV.

Time to culture conversion was described for participants in whom baseline
sputum MGIT culture was positive. The cumulative incidence of culture conversion
was reported by 30 day increments until 120 days.

We described univariable assocations between baseline characteristics and
unfavourable study outcomes as crude hazard ratios, 95% confidence intervals and
p-values. Unsuccessful treatment outcomes and death or recurrence during
follow-up were defined as unsuccessful study outcomes. Participants who were
lost to post-treatment follow-up where censored. We then fitted a multivariable
Cox proportional hazard model with a random intercept to account for clustering
by study country. Characteristics with a p<0.1 were included. Since very few
missing values were present in the data set, we used a complete case approach to
handling missingness. The effects of imputing missing values on model estimates
were explored through sensitivity analyses.

All statistical analyses were performed with R software (version 4.3.0).

\newpage

```{r wrap="Treatment cohort description", echo = FALSE}
htmltools::h2(
  "Baseline demographic and clinical characteristics of participants"
)
htmltools::hr()
autofit(params$tables$tx_description)
```
\newpage

```{r wrap="Treatment cohort outcomes", echo = FALSE}
htmltools::h2(
  "Description of end of treatment and end of study outcomes for all
participants"
)

htmltools::hr()

params$tables$tx_outcomes
params$plots$p1

params$plots$p2
```

<!---BLOCK_LANDSCAPE_START--->

```{r wrap="Predictors of unsuccessful outcome", echo = FALSE}
htmltools::h2(
  "Crude and adjusted analysis of independent predictors of unsuccessful study outcome"
)
htmltools::hr()
autofit(params$tables$tx_mv_failure)
```
<!---BLOCK_LANDSCAPE_STOP--->

```{r wrap="Treatment outcomes by HIV status", echo = FALSE}
htmltools::h2(
  "Description of end of treatment and end of study outcomes for all participants by baseline HIV status"
)
htmltools::hr()
params$tables$tx_outcomes_by_hiv

params$plots$p3
```

\newpage

```{r wrap="Baseline HIV treatment and CD4 count description", echo = FALSE}
htmltools::h2(
  "Description of baseline CD4 count and HIV treatment regimens in participants living with HIV"
)
htmltools::hr()
params$tables$hiv_outcomes

params$plots$p4

params$plots$p5
```
<!---BLOCK_LANDSCAPE_START--->

```{r wrap="Failure & Death by HIV-specific factors", echo = FALSE}
htmltools::h2(
  "Crude associations between baseline HIV treatment and CD4 count and time to unsuccessful outcome and time to death"
)
htmltools::hr()
params$tables$hiv_failure_death
```

<!---BLOCK_LANDSCAPE_STOP--->

```{r wrap="Culture conversion risk", echo = FALSE}
htmltools::h2(
  "Cumulative incidence of culture conversion by monthly time-points"
)
htmltools::hr()
params$tables$cc_risk

params$plots$conversion
```

\newpage

```{r wrap="Reasons for discontinuation", echo = FALSE}
htmltools::h2(
  "Cumulative incidence of culture conversion by monthly time-points"
)
htmltools::hr()
htmltools::p("
The reasons for failure may not be correct. They are taken
from the `prtclviol` variable and are restricted to only
those participants who were given an outcome of `Failed`.

More information is likely to be availble for those
with `Other` reasons for ceasing treatment in the `trtcom`
variable.
")
htmltools::hr()
params$tables$failure_reasons
```
\newpage

```{r wrap="Outcomes after 12 months follow-up", echo = FALSE}
htmltools::h2(
  "Treatment and study oucomes in participants with 12 months follow-up"
)
htmltools::hr()
params$tables$full_fu
```
\newpage

```{r wrap="Probability of study success during follow-up", echo = FALSE}
htmltools::h2(
  "Overall probability of successful study outcome during treatment follow-up"
)
htmltools::hr()
params$plots$fu_survival
params$tables$fu_survival
```
