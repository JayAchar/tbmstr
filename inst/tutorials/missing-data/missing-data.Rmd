---
title: "Effects of missing data and misclassification"
output: 
  learnr::tutorial:
    progressive: true
    df_print: paged
runtime: shiny_prerendered
---

```{r setup, include=FALSE}
library(learnr)
library(gradethis)
knitr::opts_chunk$set(
  echo = FALSE,
  exercise.completion = TRUE
)
```

## Calculating a mean and starndard deviation 

Since scientific research is dependent on study data, missing values are 
detrimental to the research process. During study implementation, minimising
the amount of missing data is crucial to conducting a rigorous study that 
allows robust conclusions to be drawn.

In this tutorial, you will use R to calculate a mean, an odds ratio, standard
erros and 95% confidence intervals of sample data. At each step, you will see 
how missing data can influence these summary values. 

### Calculating a mean with R 

Write the R code required to calculate the mean of 4, 7, and 1:

```{r manually-calculate-mean, exercise=TRUE, exercise.lines = 3}

```
```{r manually-calculate-mean-check}
grade_this({
  if (.result == mean(c(4, 7, 1))) {
    pass("Well done! Did you use the `mean` function? Type `?mean` to
         learn more about this important function.")
  }
  fail("Sorry - that's not right. Try using the `mean` function.")
})
```

### Missing values and `mean()`

Notice how the `mean` function does not automatically handle missing values.
Run the code below to see the answer generated, then try to adjust it to
get the correct answer. *Remember that you can read the function documentation
by typing `?mean` into your RStudio terminal*. 

```{r missing-values-mean, exercise = TRUE, exercise.lines = 2}
mean(c(4, NA, 1))
```
```{r missing-values-mean-check}
grade_this({
  if (.result == mean(c(4, NA, 1), na.rm = TRUE)) {
    pass("Well done! Did you read the documentation?")
  }
  fail("Sorry - that's not right. Try reading the help documentation.")
})
```

### Calculating the standard deviation with R

Calculating the standard deviation is more difficult to do manually. Use the
`sd` function to calculate the standard deviation of 4, 7, and 2:

```{r manually-calculate-sd, exercise = TRUE, exercise.lines = 3}

```
```{r manually-calculate-sd-hint}
sd(c(4, 7, 2))
```
```{r manually-calculate-sd-check}
grade_this({
  if (.result == sd(c(4, 7, 2))) {
    pass("Well done! Type `?sd` to learn more.")
  }
  fail("Sorry - that's not right. Try looking at the hint.")
})
```


## Calculating an Odds Ratio

### Calculating the odds of success

We can use the odds and an odds ratio to compare an outcome with two levels between groups.
This example data shows the success and failure of TB treatment in 200 men and women (only the first 10 entries are shown).

```{r odds-setup}
set.seed(12345)
male <- data.frame(
  sex = "Male",
  outcome = ifelse(rbinom(100, 1, 0.55) == 1, "Success", "Failure")
)

female <- data.frame(
  sex = "Female",
  outcome = ifelse(rbinom(100, 1, 0.65) == 1, "Success", "Failure")
)

df <- rbind(male, female)
df <- df[sample(1:nrow(df)), ]
```

```{r example-data}
knitr::kable(head(df, 10), row.names = FALSE)
```

We can calculate the odds of success for men using the following code:

```{r odds-men, exercise = TRUE, exercise.eval = TRUE, exercise.setup = "odds-setup"}
sum(df$outcome[df$sex == "Male"] == "Success")
```

Can you calculate the odds of success for women? 

```{r odds-female-hint}
sum(df$outcome[df$sex == "Female"] == "Success")
```

```{r odds-female, exercise = TRUE, exercise.setup = "odds-setup"}
```

```{r odds-female-check}
grade_this({
  if (.result == sum(df$outcome[df$sex == "Female"] == "Success")) {
    pass("Well done! You got the right answer!")
  }
  fail("Sorry - that's not right. Try looking at the hint")
})
```



### Quiz

*You can include any number of single or multiple choice questions as a quiz. Use the `question` function to define a question and the `quiz` function for grouping multiple questions together.*

Some questions to verify that you understand the purposes of various base and recommended R packages:

```{r quiz}
quiz(
  question(
    "Which package contains functions for installing other R packages?",
    answer("base"),
    answer("tools"),
    answer("utils", correct = TRUE),
    answer("codetools")
  ),
  question(
    "Which of the R packages listed below are used to create plots?",
    answer("lattice", correct = TRUE),
    answer("tools"),
    answer("stats"),
    answer("grid", correct = TRUE)
  )
)
```
